---
title: "excess helper code"
author: "Michael Najarro"
date: "4/14/2021"
output: html_document
---

I ran step 1 initially to generate a data frame containing
the important error parameter inputs for the sum of squares function.

```{r}
library(pacman)
p_load(tidyverse, 
       here,
       R.matlab)
```


## 1. Generating the Y data sets
Please note that to run the SS PEPRMT Ch4 script, 
I rely on eddy covariance tower data.

Unfortunately, that data is only available for 2018, so I randomly sample values from the original data to generate a complete set for 2018 to 2020, and then save the new data as a new csv file.

```{r eval=FALSE}
# bring PEPRMT methane function into environ.
EL_2018_master <- readMat(here('data_sets', 'EL_2018_master.mat'))

# pull out the relevant flux and error data.
# el_2018_master -> data -> data frame 2
y <- as.data.frame(EL_2018_master$data[[2]])

# pull out column 2, and add tack on 554 sampled
# values from 2018.
ydata <- y$V2
temp2 <- sample(ydata, size = 554, replace = TRUE)
ydata <- c(ydata,temp2)

# pull out column 3, and add tack on 554 sampled
# values from 2018.
gpf <- y$V3
temp3 <- sample(gpf, size = 554, replace = TRUE)
gpf <- c(gpf, temp3)

# pull out column 4, then tack on 554 sampled
# values from 2018.
re <- y$V4
temp4 <- sample(re, size = 554, replace = TRUE)
re <- c(re, temp4)

# now create a new csv file for the data.
y2 <- as.data.frame(cbind(ydata, gpf, re))
write_csv(y2, file = "./data_sets/EL_ECV_ydata_18_20.csv")

rm(gpf,
   re,
   temp2,
   temp3,
   temp4,
   ydata,
   y,
   EL_2018_master,
   EL_2018_2020_master_9_30_20)
```

#2. Adjust the revised Eden Landing CH4 data 

written 4/15/21:
Unfortunately, at this point running the PEPRMT CH4 script on the revised CH4 data will produce a bunch of zeroes for the ouput columns whether one chooses to use file `EL_dataprepared_CH4_SI.csv` or `revised_EL_CH4_prepared_data.csv`.

I suspect the root of the issue lies in the variance of the S1 and S2. Much of the carbon that creates methane is heavily allocated to S1 and almost nothing to S2. when these two parameters are fed into PEPRMT CH4 7.2.2, the latest version which no longer uses the microsite approach, the calculations of M1 and M2, which rely on S1 and S2 will zero out due to the very small numbers.

THe code below adjusts the S2 Pool of `revised_EL_CH4_prepared_data.csv` to boost the S2 pool to a set of values within a range of 2000; technically the values should be incrementing over time but for the purposes of testing, I will create a vector of 2000 for each row, and adds numberrs sampled from an exponential distribution.

```{r}
#bring your data in
d <- readr::read_csv(here("data_sets", "EL_2018_2020_master_9_30_20.csv"))

# generate s2 column; first the 2000s, then additional,
# fractional methane.
j<- rep(2000, nrow(d))

x <- seq(0,2, .001)
f<- sort(sample(x, size=length(j)))
f

s2 <- j+f

# now replace the s2 column with the new s2 vector created.
revised_EL_CH4_prepared_data$S2 <- s2

#clean up data
rm(d,j,x,f,s2)

#export  the dataframe to a csv file.
write_csv(revised_EL_CH4_prepared_data, 
          file = "./data_sets/revised_EL_CH4_prepared_data2.csv")
```

 